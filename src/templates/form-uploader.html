<div ng-if="uploader" class="form-uploader-container">
    <div ng-repeat="(type, msg) in messages">
        <div ng-show="msg" class="alert alert-{{type}} alert-dismissible flash" role="alert">
            <button type="button" ng-click="cleanMessage(type)" class="close">
                <span aria-hidden="true">&times;</span>
            </button>
            <strong>
                <i ng-class="{'fa-warning': type=='danger', 'fa-info': type=='info', 'fa-check': type=='success'}" class="fa"></i>
            </strong>
            {{msg}}
        </div>
    </div>

    <div class="clear"></div>

    <div class="text-center">
        <input type="file" nv-file-select multiple uploader="uploader" id="file" ng-hide="true">
        <div ng-show="uploader.isHTML5" class="upFile" data-id="default" role="button">
            <div nv-file-drop="" uploader="uploader" ng-click="openFile()">
                <div nv-file-over="file-over" uploader="uploader" over-class="another-file-over" class="well my-drop-zone">
                    Arrate aqui ou clique para efetuar o upload
                    <i class="fa fa-upload"></i>
                </div>
            </div>
        </div>
    </div>

    <div ng-show="uploader.queue.length>1">
        <div class="file-group-item">
            <div class="col-md-3">
                <button type="button" class="btn btn-success btn-xs" ng-click="uploader.uploadAll()" ng-disabled="!uploader.getNotUploadedItems().length"
                        uib-tooltip="Enviar tudo" uib-tooltip-placement="top" uib-tooltip-trigger="mouseenter">
                    <span class="glyphicon glyphicon-upload"></span>
                </button>
                <button type="button" class="btn btn-warning btn-xs" ng-click="uploader.cancelAll()" ng-disabled="!uploader.isUploading"
                        uib-tooltip="Cancelar tudo" uib-tooltip-placement="top" uib-tooltip-trigger="mouseenter">
                    <span class="glyphicon glyphicon-ban-circle"></span>
                </button>
                <button type="button" class="btn btn-danger btn-xs" ng-click="deleteAll(uploader)" ng-disabled="!uploader.queue.length"
                        uib-tooltip="Remover tudo" uib-tooltip-placement="top" uib-tooltip-trigger="mouseenter">
                    <span class="glyphicon glyphicon-remove"></span>
                </button>
            </div>
            <div class="col-md-2 text-center">
                <span class="badge" ng-bind="uploader.queue.length"></span>
            </div>
            <div class="col-md-7">
                <div ng-show="uploader.isHTML5">
                    <div class="progress" style="margin-bottom: 0;">
                        <div class="progress-bar" role="progressbar" ng-style="{ 'width': uploader.progress + '%' }">{{ uploader.progress + '%'}}</div>
                    </div>
                </div>
            </div>

            <div class="clear"></div>
        </div>
    </div>

    <div ng-repeat="item in uploader.queue">
        <div class="file-group-item">
            <div class="col-md-3">
                <button type="button" class="btn btn-success btn-xs" uib-tooltip="Enviar" ng-click="item.upload()" ng-disabled="item.isReady || item.isUploading || item.isSuccess">
                    <span class="glyphicon glyphicon-upload"></span>
                </button>
                <button type="button" class="btn btn-warning btn-xs" uib-tooltip="Cancelar" ng-click="item.cancel()" ng-disabled="!item.isUploading">
                    <span class="glyphicon glyphicon-ban-circle"></span>
                </button>
                <button type="button" uib-tooltip="Remover" class="btn btn-danger btn-xs" ng-click="deleteItem(item)">
                    <span class="glyphicon glyphicon-remove"></span>
                </button>
                
                <i ng-show="item.showLoading" class="loader glyphicon glyphicon-repeat"></i>

                <span uib-tooltip="Progresso bem-sucedido" class="label label-success" ng-show="item.isSuccess">
                    <i class="glyphicon glyphicon-ok"></i>
                </span>
                <span uib-tooltip="Progresso cancelado" class="label label-warning" ng-show="item.isCancel">
                    <i class="glyphicon glyphicon-ban-circle"></i>
                </span>
                <span uib-tooltip="Erro no progresso" class="label label-danger" ng-show="item.isError">
                    <i class="glyphicon glyphicon-alert"></i>
                </span>
            </div>

            <div class="col-md-2 text-center">
                <div ng-switch="isImage(uploader.isHTML5, item.file)">
                    <div ng-switch-when="true" class="image-preview" ng-mouseover="hoverCrop = true" ng-mouseleave="hoverCrop = false">
                        <i class="fa fa-cut" ng-show="hoverCrop"></i>
                        <div ng-click="setInstance(item,$event)" data-toggle="modal" data-target="#modal-crop" ng-thumb="{file: item._file, height: 80}"></div>
                    </div>
                    <i ng-switch-when="false" class="glyphicon glyphicon-file"></i>
                </div>
            </div>
            <div class="col-md-4 text-center">
                <div class="force-text" ng-bind="item.file.name| shortName:17:true" uib-tooltip="{{item.file.name}}"></div>
            </div>
            <div class="col-md-1">
                <span tooltip="Size" tooltip-placement="top" tooltip-trigger="mouseenter" ng-show="uploader.isHTML5" nowrap>
                    {{ item.file.size/1024/1024|number:2 }} MB
                </span>
            </div>
            <div class="col-md-2">
                <div ng-show="uploader.isHTML5">
                    <div class="progress" style="margin-bottom: 0;">
                        <div class="progress-bar" role="progressbar" ng-style="{ 'width': item.progress + '%' }">
                            {{item.progress + '%'}}
                        </div>
                    </div>
                </div>
            </div>
            <div class="clear"></div>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="modal-crop" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="myModalLabel">Cortar imagem</h4>
            </div>
            <div class="modal-body">
                <!-- Nav tabs -->
                <ul class="nav nav-tabs nav-justified" role="tablist">
                    <li role="presentation" class="active">
                        <a role="tab" data-target="#crop" data-toggle="tab">Corte</a>
                    </li>
                    <li role="presentation">
                        <a role="tab" data-target="#preview" data-toggle="tab">Pre-visualização</a>
                    </li>
                </ul>
                <!-- Tab panes -->
                <div class="tab-content">
                    <div role="tabpanel" class="tab-pane active" id="crop">
                        <div class="cropArea">
                            <img-crop image="cropImage" result-image="cropImageResult" area-type="square" area-min-size="50" result-image-quality="1.0"
                                result-image-size="cropSize"></img-crop>
                        </div>
                    </div>
                    <div role="tabpanel" class="tab-pane" id="preview">
                        <img ng-src="{{cropImageResult}}" width="100%" height="350" />
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" ng-click="saveCrop()">Salvar</button>
            </div>
        </div>
    </div>
</div>
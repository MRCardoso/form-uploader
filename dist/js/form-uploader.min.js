!function(){"use strict";angular.module("form.uploader",["angularFileUpload","ngThumbCanvas","formCustomChange","formDragDrop"]).run(["$rootScope",function(e){}])}(),angular.module("form.uploader").run(["$templateCache",function(e){e.put("form-uploader.html",'<div ng-if="uploader" class="form-uploader-container">\n    <div ng-repeat="(type, msg) in messages">\n        <div ng-show="msg" class="alert alert-{{type}} alert-dismissible flash" role="alert">\n            <button type="button" ng-click="cleanMessage(type)" class="close">\n                <span aria-hidden="true">&times;</span>\n            </button>\n            <strong>\n                <i ng-class="{\'fa-warning\': type==\'danger\', \'fa-info\': type==\'info\', \'fa-check\': type==\'success\'}" class="fa"></i>\n            </strong>\n            {{msg}}\n        </div>\n    </div>\n\n    <div class="clear"></div>\n\n    <div ng-switch="many">\n        <div ng-switch-when="true">\n            <input type="file" nv-file-select multiple uploader="uploader" id="file-{{elKey}}" ng-hide="true">\n            <div ng-show="uploader.isHTML5" class="{{elKey}} text-center" data-id="default" role="button">\n                <div nv-file-drop="" uploader="uploader" ng-click="openFile()">\n                    <div nv-file-over="file-over" uploader="uploader" over-class="another-file-over" class="well my-drop-zone">\n                        Arrate aqui ou clique para efetuar o upload\n                        <i class="fa fa-upload"></i>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div ng-switch-when="false" ng-if="uploader.queue.length==0" class="file-group-item">\n            <input type="file" nv-file-select uploader="uploader" id="file-{{elKey}}" ng-hide="true">\n            <div ng-show="uploader.isHTML5" class="{{elKey}} text-center" data-id="default" role="button">\n                <div nv-file-drop="" uploader="uploader" ng-click="openFile()">\n                    <div nv-file-over="file-over" uploader="uploader" over-class="another-file-over" class="well my-drop-zone">\n                        <ng-transclude>\n                            Arrate aqui ou clique para efetuar o upload\n                            <i class="fa fa-upload"></i>\n                        </ng-transclude>\n                    </div>\n                    <p ng-if="errors!=null" ng-bind="errors" class="text-warning" ng-click="cleanMessage(\'errors\',$event)"></p>\n                    <p ng-if="success!=null" ng-bind="success" class="text-success" ng-click="cleanMessage(\'success\',$event)"></p>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <div ng-show="uploader.queue.length>1">\n        <div class="file-group">\n            <div class="col-md-4">\n                <span class="item-circled text-success fa fa-cloud-upload" ng-click="uploader.uploadAll()" ng-hide="!uploader.getNotUploadedItems().length"\n                        uib-tooltip="Enviar tudo" uib-tooltip-placement="top" uib-tooltip-trigger="mouseenter">\n                </span>\n                <button type="button" class="item-circled text-warning fa fa-ban" ng-click="uploader.cancelAll()" ng-disabled="!uploader.isUploading"\n                        uib-tooltip="Cancelar tudo" uib-tooltip-placement="top" uib-tooltip-trigger="mouseenter">\n                </button>\n                <button type="button" class="item-circled text-danger fa fa-times-circle" ng-click="deleteAll(uploader)" ng-disabled="!uploader.queue.length"\n                        uib-tooltip="Remover tudo" uib-tooltip-placement="top" uib-tooltip-trigger="mouseenter">\n                </button>\n\n                <div class="badge pull-right">\n                    Total de arquivos: {{uploader.queue.length}}\n                </div>\n            </div>\n            <div class="col-md-8">\n                <div ng-show="uploader.isHTML5">\n                    <div class="progress" style="margin-bottom: 0;">\n                        <div class="progress-bar" role="progressbar" ng-style="{ \'width\': uploader.progress + \'%\' }">{{ uploader.progress + \'%\'}}</div>\n                    </div>\n                </div>\n            </div>\n\n            <div class="clear"></div>\n        </div>\n    </div>\n\n    <div class="file-group" ng-show="uploader.queue.length>0">\n        <div ng-repeat="item in uploader.queue" class="file-group-item">\n            <div class="pull-left">\n                <span class="badge" tooltip="Size" tooltip-placement="top" tooltip-trigger="mouseenter" nowrap>\n                    {{ limitToMB(item.file.size) }} MB\n                </span>\n            </div>\n            <div class="text-right">\n                <button type="button" class="item-circled text-danger fa fa-times-circle" ng-click="deleteItem(item)"></button>\n                <button type="button" class="item-circled text-warning fa fa-ban" uib-tooltip="Cancelar" ng-click="item.cancel()" ng-disabled="!item.isUploading"></button>\n                <span class="item-circled text-success fa fa-cloud-upload" uib-tooltip="Enviar" ng-click="item.upload()" ng-hide="item.isReady || item.isUploading || item.isSuccess"></span>\n            \n                <i ng-show="item.showLoading" class="loader glyphicon glyphicon-repeat"></i>\n            \n                <span uib-tooltip="Progresso bem-sucedido" class="item-circled text-success fa fa-check-circle" ng-show="item.isSuccess"></span>\n                <span uib-tooltip="Progresso cancelado" class="item-circled text-warning fa fa-ban" ng-show="item.isCancel"></span>\n                <span uib-tooltip="Erro no progresso" class="item-circled text-danger fa fa-times-circle" ng-show="item.isError"></span>\n            </div>\n            \n            <div ng-switch="isImage(uploader.isHTML5, item.file)">\n                <div ng-switch-when="true" class="image-preview" ng-mouseover="hoverCrop = true" ng-mouseleave="hoverCrop = false">\n                    <i class="fa fa-cut" ng-show="hoverCrop"></i>\n                    <div ng-click="setInstance(item,$event)" data-toggle="modal" data-target="#modal-crop" ng-thumb="{file: item._file, height: 80}"></div>\n                </div>\n                <i ng-switch-when="false" class="glyphicon glyphicon-file"></i>\n            \n                <div ng-show="uploader.isHTML5">\n                    <div class="progress" style="margin-bottom: 0;">\n                        <div class="progress-bar" role="progressbar" ng-style="{ \'width\': item.progress + \'%\' }">\n                            {{item.progress + \'%\'}}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n\n<div ng-include="\'modal-crop.html\'"></div>'),e.put("modal-crop.html",'\x3c!-- Modal --\x3e\n<div class="modal fade" id="modal-crop" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">\n    <div class="modal-dialog" role="document">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n                    <span aria-hidden="true">&times;</span>\n                </button>\n                <h4 class="modal-title" id="myModalLabel">Cortar imagem</h4>\n            </div>\n            <div class="modal-body">\n                \x3c!-- Nav tabs --\x3e\n                <ul class="nav nav-tabs nav-justified" role="tablist">\n                    <li role="presentation" class="active">\n                        <a role="tab" data-target="#crop" data-toggle="tab">Corte</a>\n                    </li>\n                    <li role="presentation">\n                        <a role="tab" data-target="#preview" data-toggle="tab">Pre-visualização</a>\n                    </li>\n                </ul>\n                \x3c!-- Tab panes --\x3e\n                <div class="tab-content">\n                    <div role="tabpanel" class="tab-pane active" id="crop">\n                        <div class="cropArea">\n                            <img-crop image="cropImage" result-image="$parent.cropImageResult" area-type="square" area-min-size="50" result-image-quality="1.0"\n                                result-image-size="cropSize"></img-crop>\n                        </div>\n                    </div>\n                    <div role="tabpanel" class="tab-pane" id="preview">\n                        <img ng-src="{{$parent.cropImageResult}}" width="100%" height="350" />\n                    </div>\n                </div>\n            </div>\n            <div class="modal-footer">\n                <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>\n                <button type="button" class="btn btn-primary" ng-click="saveCrop()">Salvar</button>\n            </div>\n        </div>\n    </div>\n</div>')}]),angular.module("form.uploader").filter("shortName",function(){return function(e,n,a){if(n=n||20,a=!!angular.isDefined(a)&&a,20<e.length){var t=e.substr(0,n);if(a)t+=["...(.",e.split(".").pop(),")"].join("");return t}return e}}),angular.module("ngThumbCanvas",[]).directive("ngThumb",["$window",function(n){var r=!(!n.FileReader||!n.CanvasRenderingContext2D),s=function(e){return angular.isObject(e)&&e instanceof n.File},d=function(e){var n="|"+e.type.slice(e.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(n)};return{restrict:"A",template:"<canvas/>",link:function(e,n,a){if(r){var t=e.$eval(a.ngThumb);if(s(t.file)&&d(t.file)){var i=n.find("canvas"),l=new FileReader;l.onload=function(e){var n=new Image;n.onload=o,n.src=e.target.result},l.readAsDataURL(t.file)}}function o(){var e=t.width||this.width/this.height*t.height,n=t.height||this.height/this.width*t.width;i.attr({width:e,height:n}),i[0].getContext("2d").drawImage(this,0,0,e,n)}}}}]),angular.module("formCustomChange",[]).directive("customChange",[function(){return{restrict:"A",link:function(e,n,a,t){var i=e.$eval(a.customChange);n.bind("change",i)}}}]),angular.module("formDragDrop",[]).directive("dragDrop",function(){return{link:function(n,a,t){a.on("dragover",function(e){e.preventDefault(),a.addClass(t.dragDropOver)}),a.on("dragleave",function(e){e.preventDefault(),a.removeClass(t.dragDropOver)}),a.on("drop",function(e){e.preventDefault(),a.removeClass(t.dragDropOver),n.onChangeFile({target:{files:e.originalEvent.dataTransfer.files}})})}}}),angular.module("form.uploader").directive("formUploader",function(){return{restrict:"E",templateUrl:"form-uploader.html",require:["angularFileUpload"],transclude:!0,scope:{many:"=?many",allowType:"@allowType",validators:"=?validators",defaultLimit:"=?defaultLimit",removeUrl:"=?removeUrl",sendUrl:"=?sendUrl"},controller:["$scope","FileUploader","$http","$filter","ImageService",function(i,e,a,n,t){if(angular.isUndefined(i.sendUrl))return console.warn("Por Favor, Defina uma 'url' para este upload");var l=[];i.errors=null,i.success=null,i.many=!angular.isUndefined(i.many)&&i.many,i.validators=angular.isUndefined(i.validators)?[]:i.validators,i.removeUrl=angular.isUndefined(i.removeUrl)?null:i.removeUrl,i.defaultLimit=angular.isUndefined(i.defaultLimit)?3145728:i.defaultLimit;var o=i.elKey=t.getElementKey();i.cleanMessage=function(e,n){n.stopPropagation(),i[e]=null},i.openFile=function(){var e=angular.element;e(document).off("click."+o).on("click."+o,"."+o,function(){e("#file-"+o).off("click").trigger("click")})},i.deleteItem=function(n){!i.uploadOnSubmit&&"uploadedPath"in n&&null!=i.removeUrl?(n.showLoading=!0,r([n.uploadedPath],function(e){n.showLoading=!1,i.success=e.data.message,n.remove()})):n.remove()},i.deleteAll=function(n){0<l.length&&null!=i.removeUrl?r(l,function(e){l=[],i.success=e.data.message,n.clearQueue()}):n.clearQueue()},i.isImage=function(e,n){return t.isImage(e,n.type)},i.limitToMB=function(e){return t.limitToMB(e)},i.setInstance=function(e,n){t.setCrop(i,e,n)},i.saveCrop=function(){t.saveCrop(i)};var r=function(e,n){a.post(i.removeUrl,{Keys:e}).then(function(e){n(e)},function(e){i.errors=e.data.message})},s=i.uploader=new e({url:i.sendUrl,queueLimit:i.defaultLimit});t.setDefaultValidators(i.allowType,i.defaultLimit),s.filters=t.getValidators(i.validators),s.onAfterAddingFile=function(e){i.many||1<e.uploader.queue.length&&(e.uploader.queue=[e.uploader.queue[e.uploader.queue.length-1]])},s.onBeforeUploadItem=function(e){e.showLoading=!0,i.$root.$broadcast("form.uploader.begin")},s.onWhenAddingFileFailed=function(e,n,a){i.errors=t.getError(n.name)},s.onCancelItem=function(e,n,a,t){i.errors="Envio abortado com sucess!"},s.onCompleteItem=function(e,n,a,t){e.showLoading=!1,0!=a&&""!=n&&(200==a?(e.uploadedPath=n.path,l.push(n.path),i.success=n.message):i.errors=n.message),i.$root.$broadcast("form.uploader.finish",n)}}]}}),angular.module("form.uploader").factory("ImageService",["$filter",function(n){var s=null,a=[],r={},t=function(t,i,l,o){a.push({name:t,fn:function(e,n){var a=!0;switch(l){case"rx":a=new RegExp(i,"i").test(e.name);break;case"lt":a=e.size<i;break;default:"function"==typeof l&&(a=l(e,value))}return a||(r[t]=o),a}})},i=function(e){return n("number")(e/1024/1024,0)};return{setCrop:function(a,e,n){a.cropImage="",a.cropImageResult="",a.cropSize=600,(s=e).element=n;var t=new FileReader;t.onload=function(n){a.$apply(function(){a.cropImage=n.target.result;var e=new Image;e.onload=function(){a.cropSize=this.width},e.src=a.cropImage,delete e})},t.readAsDataURL(e._file)},saveCrop:function(e){for(var n=e.cropImageResult.split(","),a=atob(n[1]),t=a.length,i=new Uint8Array(t);t--;)i[t]=a.charCodeAt(t);var l=s.element.target,o=new File([i],s.file.name,{type:s.file.type}),r=new Image;r.onload=function(){l.getContext("2d").drawImage(this,0,0,l.width,l.height)},r.src=e.cropImageResult,s._file=o,angular.element(document.getElementById("modal-crop")).modal("hide"),delete r},getValidators:function(e){return 0<e.length&&e.map(function(e){t(e.name,e.values,e.type,e.message)}),a},setValidator:t,setDefaultValidators:function(e,n){angular.isDefined(e)&&t("typeAllow",e,"rx","A extensão deve ser '"+e.replace(/(\|)/gi,", ")+"'"),t("sizeAllow",n,"lt","O tamanho deve ter até "+i(n)+"MB")},isImage:function(e,n){return!!/(gif|jpg|jpeg|png|x-png|pjpeg)/.test(n)&&e},limitToMB:i,getError:function(e){return r[e]||null},getElementKey:function(){return"file-item-"+Math.floor(Math.random()*Date.now()+1)}}}]);